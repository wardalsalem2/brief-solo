document
  .getElementById("burger-menu-btn")
  .addEventListener("click", function () {
    document.getElementById("sidebar").classList.toggle("active");
  });

window.addEventListener("click", function (event) {
  const sidebar = document.getElementById("sidebar");
  const burgerMenuBtn = document.getElementById("burger-menu-btn");
  if (
    !sidebar.contains(event.target) &&
    !burgerMenuBtn.contains(event.target)
  ) {
    sidebar.classList.remove("active");
  }
});

window.addEventListener("scroll", function () {
  const navbar = document.querySelector("header");
  navbar.classList.toggle("sticky", window.scrollY > 0);
});

document.querySelectorAll("#username, #profile-photo").forEach((element) => {
  element.addEventListener("click", function () {
    const dropdownMenu = document.getElementById("dropdown-menu");
    dropdownMenu.style.display =
      dropdownMenu.style.display === "none" ? "block" : "none";
  });
});

window.addEventListener("click", function (event) {
  const dropdownMenu = document.getElementById("dropdown-menu");
  const username = document.getElementById("username");
  const profilePhoto = document.getElementById("profile-photo");
  if (
    !dropdownMenu.contains(event.target) &&
    !username.contains(event.target) &&
    !profilePhoto.contains(event.target)
  ) {
    dropdownMenu.style.display = "none";
  }
});

const userSession = JSON.parse(sessionStorage.getItem("userSession") || "{}");
const loggedIn = userSession.loggedIn || false;

if (!loggedIn) {
  alert("Unauthorized access detected. You have been banned permanently.");
  localStorage.setItem("banned", "true");
  window.location.href = "01-Welcome-Page.html";
}

const username =
  userSession.username.charAt(0).toUpperCase() + userSession.username.slice(1);
document.getElementById("username").textContent = username;
document.querySelector(".welcome-msg-username").textContent = username;

const selectTopic = document.getElementById("select-topic");
const startQuizBtn = document.getElementById("select-start-quiz-btn");

fetch("QuizAce-Questions.json")
  .then((response) => response.json())
  .then((data) => {
    const topics = Object.keys(data);
    topics.forEach((topic) => {
      const option = document.createElement("option");
      option.value = topic;
      option.textContent = topic.charAt(0).toUpperCase() + topic.slice(1);
      selectTopic.appendChild(option);
    });
  })
  .catch((error) => console.error("Error fetching quiz topics:", error));

selectTopic.addEventListener("change", function () {
  startQuizBtn.disabled = false;
  const selectedTopic = selectTopic.value;
  fetch("QuizAce-Questions.json")
    .then((response) => response.json())
    .then((data) => {
      const questions = data[selectedTopic];
      const selectedQuestions = [];
      while (selectedQuestions.length < 4) {
        const randomIndex = Math.floor(Math.random() * questions.length);
        if (!selectedQuestions.includes(questions[randomIndex])) {
          selectedQuestions.push(questions[randomIndex]);
        }
      }
      userSession.selectedQuestions = selectedQuestions;
      userSession.topic = selectedTopic;
      sessionStorage.setItem("userSession", JSON.stringify(userSession));
      sessionStorage.setItem("topic", selectedTopic);
    })
    .catch((error) => console.error("Error fetching quiz questions:", error));
});

startQuizBtn.addEventListener("click", function () {
  window.location.href = "05-Quiz-Page.html";
});

document.getElementById("logout-link").addEventListener("click", function () {
  sessionStorage.removeItem("userSession");
  sessionStorage.removeItem("loggedIn");
  sessionStorage.removeItem("fromWelcomePage");
  sessionStorage.removeItem("fromSignupPage");
  window.location.href = "01-Welcome-Page.html";
});
